---
title: Day2b practical
output: html_document
---

First encode the samples:
```{r}
nC <- rbind (c(0,1,1), c(0,1,0), c(0,0,0), c(1,1,0))
sC <- rbind (c(0,0,0), c(0,0,0), c(0,0,0), c(0,1,0))
```

Then compute allele frequunecies:
```{r}
computeAlleleFreqs <- function (genoMatrix) { colSums (genoMatrix) / dim(genoMatrix)[1] }
nCFreqs <- computeAlleleFreqs (nC)
sCFreqs <- computeAlleleFreqs (sC)
```

Unfolded SFS:
```{r}
computeUnfoldedSFS <- function (genoMatrix) {
  numSamples <- dim(genoMatrix)[1];
  freqBinWidth = 1/numSamples;
  # fres of alleles
  alleleFreqs <- computeAlleleFreqs (genoMatrix);
  # breaks for histogram
  theBreaks <- seq(-freqBinWidth/2, 1 + freqBinWidth/2, freqBinWidth);
  # get a histogram
  theHist <- hist(alleleFreqs, plot=FALSE, breaks = theBreaks);
  # final sfs is here
  sfs <- theHist$counts;
  return (sfs <- sfs[2:(length(sfs)-1)])
}
computeUnfoldedSFS (nC)
computeUnfoldedSFS (sC)
```

Tajima's pairwise estimator:
```{r}
tajimasEstimator <- function (genoMatrix) {
  numSamples <- dim(genoMatrix)[1];
  pwSum <- 0
  for (i in seq(numSamples)) {
    for (j in seq(i,numSamples)) {
      pwSum <- pwSum + sum(abs(genoMatrix[i,] - genoMatrix[j,]));
      # print (paste(i, j, sum(abs(genoMatrix[i,] - genoMatrix[j,]))))
    }
  }
  return (2*pwSum/(numSamples*(numSamples-1)));
}
tajimasEstimator (nC)
tajimasEstimator (sC)
```

Watterson's estimator:
```{r}
wattersonsEstimator <- function (genoMatrix) {
  numSamples <- dim(genoMatrix)[1];
  numTrueSegSites <- sum(colSums(genoMatrix) >= 1);
  harmonicMean <- sum(1/seq(1,numSamples-1));
  return (numTrueSegSites/harmonicMean);
}
wattersonsEstimator (nC)
wattersonsEstimator (sC)
```

The estimate for the northern population is 3 times higher than the estimate for the southern population. Given that the two populations evolve under a constant population size and the same mutation rate, the effective population size in the north is thus 3 times higher.